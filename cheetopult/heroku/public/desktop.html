<!-- 
    Author: Mike Newell Â© 2012
-->
<!DOCTYPE html>
<html>
    <head>
        <title>iPhone</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <link rel="stylesheet" type="text/css" href="css/style-desktop.css" />
        
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/jquery.js"><\/script>')</script>
        <script src="js/requestAnimationFrame.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
               /*
                * jQuery Plugin: externalInterface
                * Version 1.0
                *
                * Copyright (c) 2010 David Comeau (http://www.davecomeau.net)
                * Licensed jointly under the GPL and MIT licenses.
                *
                */

               (function($) 
               {
                       $.fn.externalInterface = function(args)
                       {
                               this.each(function()
                               {
                                       if(typeof(args.method) != 'undefined')
                                       {
                                               try
                                               {
                                                       if(typeof(args.args) != 'undefined')
                                                       {
                                                               var data = this[args.method](args.args);
                                                       }
                                                       else
                                                       {
                                                               var data = this[args.method]();
                                                       }

                                                       if(typeof(args.success) != 'undefined')
                                                       {
                                                               args.success(data);
                                                       }
                                               }
                                               catch(error)
                                               {
                                                       if(typeof(args.error) != 'undefined')
                                                       {
                                                               args.error(error);
                                                       }
                                               }
                                       }
                               });

                               return this;
                       };
               })(jQuery);
        </script>
        <script>
            var socket = io.connect('/');
            var theFlash;
            var flashReady;
//            var flashReady = false;

            var thisMovie = function (movieName) {
                return document.getElementById("theFlash");
            }
            
//            var checkDefined = function() {
//                theFlash = document.getElementById("theFlash");
//                if(typeof theFlash != "undefined" && typeof theFlash.iphoneConnected != "undefined") {
//                    console.log('flash and method defined');
//                    return true;
//                } else if(typeof theFlash != "undefined" && typeof theFlash.iphoneConnected == "undefined") {
//                    console.log('theFlash is defined but the method is not');
//                    return false;
//                } else {
//                    console.log('all are undefined and were totally fucked');
//                    return false;
//                }
//            }
            
            var iphoneConnected = function () {
//                thisMovie("theFlash").iphoneConnected();

                if(true) {
                    theFlash.iphoneConnected();
                }
                
            }
            
            var flyingCheeto = function (color, distance) {
//                thisMovie("theFlash").flyingCheeto(color, distance);

                console.dir(theFlash.flyingCheeto);

                if(true) {
                    theFlash.flyingCheeto(color, distance);
                }
            }
            
            socket.on('hi', function (data) {
                socket.emit('hi back', { connection: 'desktop' });
            });
            
            /*
            *  NOTE: this is where my game logic should come into play and send commands to the flash file
            **/
            socket.on('accel', function(data) {
                console.log(data);
                var color = searchPNGName(data.png);
                
                var distance = determineDistance(data.z);

                console.log('type: ' + color + ' distance: ' + distance);
                
//                callFlyingCheeto(color, distance);

                flyingCheeto(color, distance);

                
                
            });
            
//            function callFlyingCheeto(color, distance) {
//                
//                if(typeof theFlash.flyingCheeto != "undefined") {
//                    theFlash.flyingCheeto(color,distance);
//                } else {
//                    setTimeout(function() {
//                        console.log('timing out because we couldnt find the flash object');
//                        theFlash = document.getElementById("theFlash");
//                        console.dir(theFlash);
//                        callFlyingCheeto(color, distance);
//                    }, 200);
//
//                }
//                
//            }
            
            socket.on('new user', function(data) {
                
                if(data.connection == 'iphone') {
//                    callIphoneConnected();
                    iphoneConnected();
                }
                
            });
            
            
            
            
            
//            function callIphoneConnected() {
//                if(typeof theFlash.iphoneConnected != "undefined") {
//                    theFlash.iphoneConnected();
//                } else {
//                    setTimeout(function() {
//                        theFlash = document.getElementById("theFlash");
//                        console.dir(theFlash);
//                        theFlash.iphoneConnected();
//                    }, 200);
//
//                }
//            }
            
            function flashIsReady() {
                console.log('flash is ready');
                flashReady = true;
                
                setTimeout(function() {
                    flashReady = false;
                }, 25);
                
                return true;
//                flashReady = true;
            }
            
//            var initiateFlash = function(c, d) {
//
//                theFlash.flyingCheeto(c,d);
//            };
            
            var determineDistance = function(z) {
                
                z = parseFloat(z);
                
                // close, far, mouth
                if(z < -6 && z > -12) {
                    return 'close';
                } else if(z < -12 && z > -15) {
                    return 'mouth';
                } else if(z < -15) {
                    return 'far';
                }
            };
            
            var searchPNGName = function(pngName) {
                if(pngName.search('red') > -1) {
                    return 'red';
                } else if(pngName.search('green') > -1) {
                    return 'green';
                } else if(pngName.search('yellow') > -1) {
                    return 'yellow';
                } else if(pngName.search('orange') > -1) {
                    return 'orange';
                }
            };
            
            $(window).load(function() {
                
                theFlash = document.getElementById("theFlash");
                
                console.log(theFlash);
                
                console.dir(document);
                
//                setInterval(function() {
//                    
//                    if(typeof theFlash != "undefined") {
//                        theFlash.cheetoRed();
//                    } else {
//                        theFlash = document.getElementById("theFlash");
//                        theFlash.cheetoRed();
//                    }
//                    
//                    console.log("playing cheetoRed()");
//                }, 5000);
            });
            
            /*
             *  old embed code
             *  
             *  
             *  
            <!--[if !IE]>-->
            <object id="theFlash" type="application/x-shockwave-flash" data="cheetopult2.swf" width="100%" height="100%">
                <param name="movie" value="cheetopult2.swf" />
                <param name="quality" value="best" />
                <param name="bgcolor" value="#000000" />
                <param name="play" value="true" />
                <param name="loop" value="true" />
                <param name="wmode" value="window" />
                <param name="scale" value="noborder" />
                <param name="menu" value="true" />
                <param name="devicefont" value="false" />
                <param name="salign" value="" />
                <param name="allowScriptAccess" value="always" />
            <!--<![endif]-->
                <a href="http://www.adobe.com/go/getflash">
                    <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
                </a>
            <!--[if !IE]>-->
            </object>
            <!--<![endif]-->
             *
             *
             *
             <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="100%" height="100%" id="cheetopult2" align="middle">
                <param name="movie" value="cheetopult2.swf" />
                <param name="quality" value="best" />
                <param name="bgcolor" value="#ffffff" />
                <param name="play" value="true" />
                <param name="loop" value="true" />
                <param name="wmode" value="gpu" />
                <param name="scale" value="noborder" />
                <param name="menu" value="true" />
                <param name="devicefont" value="false" />
                <param name="salign" value="" />
                <param name="allowScriptAccess" value="always" />
                <!--[if !IE]>-->
                <object id="theFlash" type="application/x-shockwave-flash" data="cheetopult2.swf" width="100%" height="100%">
                    <param name="movie" value="cheetopult2.swf" />
                    <param name="quality" value="best" />
                    <param name="bgcolor" value="#ffffff" />
                    <param name="play" value="true" />
                    <param name="loop" value="true" />
                    <param name="wmode" value="gpu" />
                    <param name="scale" value="noborder" />
                    <param name="menu" value="true" />
                    <param name="devicefont" value="false" />
                    <param name="salign" value="" />
                    <param name="allowScriptAccess" value="always" />
                <!--<![endif]-->
                    <a href="http://www.adobe.com/go/getflash">
                            <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
                    </a>
                <!--[if !IE]>-->
                </object>
                <!--<![endif]-->
            </object>
             *
             *
             **/
        </script>
    </head>
    <body>
        <div id="wrap" style="width: 100%; height: 100%;">
            
            
            
            <!--[if !IE]>-->
            <object id="theFlash" type="application/x-shockwave-flash" data="cheetopult2.swf" width="100%" height="100%">
                <param name="movie" value="cheetopult2.swf" />
                <param name="quality" value="best" />
                <param name="bgcolor" value="#ffffff" />
                <param name="play" value="true" />
                <param name="loop" value="true" />
                <param name="wmode" value="gpu" />
                <param name="scale" value="noborder" />
                <param name="menu" value="true" />
                <param name="devicefont" value="false" />
                <param name="salign" value="" />
                <param name="allowScriptAccess" value="always" />
            <!--<![endif]-->
                <a href="http://www.adobe.com/go/getflash">
                    <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
                </a>
            <!--[if !IE]>-->
            </object>
            <!--<![endif]-->
            
        </div>
    </body>
</html>
